# ToyServer2 AI 가이드라인 (Architectural Constraints for AI)

이 프로젝트는 강력한 레이어 분리 및 인터페이스 기반 설계를 따릅니다. AI 에이전트(Antigravity 등)는 코드를 수정하거나 생성할 때 다음 규칙을 반드시 준수해야 합니다.

## 1. 엄격한 인터페이스 준수 (Strict Interface Usage)

*   **Rule**: `src/System/` 하위의 구현 디렉토리에 있는 헤더를 직접 포함(`include`)하지 마십시오.
*   **Allowed**: 오직 `src/System/` 루트에 위치한 `I*.h` 인터페이스 파일들만 외부(Application/Tests)에서 사용할 수 있습니다.
*   **Exception**: `System` 모듈 내부의 구현체끼리는 직접 참조가 가능하지만, 가급적 인터페이스를 통한 결합을 권장합니다.

## 2. 패킷 처리 규칙 (Packet Handling Rules)

*   **No Direct Access**: 핸들러에서 `PacketMessage` 구조체나 `IMessage.h`에 직접 의존하지 마십시오.
*   **PacketView**: 패킷 데이터 접근 시에는 반드시 `System::PacketView`를 사용하고, `packet.Parse(proto_msg)`를 통해 데이터에 접근하십시오.
*   **IPacket**: 패킷 생성 및 전송 시에는 `IPacket` 인터페이스와 그 구현체(기본 생성된 `*Packet` 클래스)만 사용하십시오.

## 3. 메모리 및 객체 관리

*   **Object Pooling**: `SimplePool.h` 등의 구현체를 직접 사용하지 말고, `IObjectPool.h` 인터페이스를 통해 객체 풀을 사용하십시오.
*   **Smart Pointers**: 수명 관리가 필요한 객체는 반드시 `std::shared_ptr` 또는 `std::unique_ptr`를 사용하며, 인터페이스 정의 시에도 이를 고려하십시오.

## 4. 데이터베이스 접근

*   **Interface**: `DBConnectionPool.h`가 아닌 `IDBConnectionPool.h`를 사용하십시오.
*   **Async First**: 게임 루프 스레드를 블로킹하지 않도록 모든 DB 작업은 `QueryAsync` 등의 비동기 인터페이스를 우선적으로 고려하십시오.
