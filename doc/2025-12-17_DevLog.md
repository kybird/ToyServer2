# 2025-12-17 개발 현황 공유

## 1. 개요
금일은 서버의 구조적 개선을 위한 리팩토링과 몬스터 AI 프레임워크 구축에 집중하였습니다. 특히 순환 참조 문제 해결을 위한 헤더/소스 분리 작업과 객체 풀링 시스템 적용이 주요 성과입니다.

## 2. 주요 작업 내용

### 2.1 몬스터 AI 프레임워크 (Hybrid AI) 구축
- **Interface 도입**: `IAIBehavior` 인터페이스를 정의하여 `Think`(판단)와 `Execute`(실행) 주기를 분리, 성능 최적화 기반 마련.
- **Behavior Tree 도입**: 보스 몬스터의 복잡한 패턴 구현을 위해 BT(Behavior Tree) 구조(Selector, Sequence, Node) 구현 및 적용.
- **AI 유형 구현**:
  - `ChaserAI`: 플레이어 추적 로직.
  - `WanderAI`: 배회 로직.
  - `SwarmAI`: 군집 이동 로직.
  - `BossAI`: BT 기반의 복합 패턴 로직.

### 2.2 MonsterFactory 리팩토링 및 순환 참조 해결
- **문제 해결**: `Monster.h`, `BossAI.h`, `MonsterFactory.h` 간의 복잡한 순환 참조로 인한 빌드 오류 발생.
- **구조 개선**: `MonsterFactory`를 헤더(.h)와 소스(.cpp)로 명확히 분리.
  - 헤더에는 선언만 남겨 의존성 최소화.
  - 소스 파일에서 구체적인 AI 헤더(`BossAI.h` 등)를 include하도록 변경.
- **Include 경로 표준화**: 모든 include 경로를 Server 루트(`Entity/...` 등) 기준으로 통일하여 `#pragma once` 오작동 방지.

### 2.3 Object Pooling 시스템 적용
- **Framework 통합**: `System/IObjectPool` 인터페이스 및 `SimplePool` 구현.
- **Factory 통합**: `MonsterFactory`, `PlayerFactory`, `ProjectileFactory`에 풀링 시스템 적용.
- **생명주기 관리**: `Release` 시 `Reset` 호출 및 스마트 포인터 커스텀 Deleter를 통한 자동 반환 메커니즘 현.

### 2.4 빌드 및 테스트 검증
- **CMake 업데이트**: 신규 AI 파일 및 분리된 Factory 소스 파일 빌드 타겟 추가.
- **테스트 수행**: `VampireSurvivorTests` 실행, Room 입장 및 AI 동작 관련 테스트 전수 통과.

## 3. 상세 변경 파일 리스트
- `src/System/IObjectPool.h` (신규)
- `src/System/Memory/SimplePool.h` (신규)
- `src/Examples/VampireSurvivor/Server/Entity/MonsterFactory.h` (수정)
- `src/Examples/VampireSurvivor/Server/Entity/MonsterFactory.cpp` (신규)
- `src/Examples/VampireSurvivor/Server/Entity/AI/IAIBehavior.h` (신규)
- `src/Examples/VampireSurvivor/Server/Entity/AI/BossAI.h` (신규)
- `src/Examples/VampireSurvivor/Server/Entity/AI/BehaviorTree/BehaviorTree.h` (신규)
- `CMakeLists.txt` (수정)
- `src/System/Dispatcher/IMessage.h` (치명적 버그 수정)
- `src/Examples/VampireSurvivor/Server/Core/UserDB.h` (Refactoring)
- 기타 다수 파일 (Include 경로 및 네임스페이스 정리)

### 2.5 ODR(One Definition Rule) 디버깅 및 헤더 정리
- **이슈 사항**: MSVC 컴파일러 환경에서 4시간 가량 소요된 난해한 링킹/런타임 오류 추적.
- **원인 분석**: `src/System/Dispatcher/IMessage.h` 파일 최하단에 `ITimer`가 `struct`로 잘못 전방 선언됨(`struct ITimer;`). 실제 정의는 `class ITimer`임. MSVC는 `struct`와 `class`를 서로 다른 심볼로 맹글링(Mangling)하여 링커가 정의를 찾지 못하거나 엉뚱한 심볼을 참조하는 ODR 위반 발생.
- **해결 조치**: `IMessage.h`의 잘못된 `struct ITimer;` 선언 삭제.
- **코드 품질 개선**:
  - 디버깅 과정에서 헤더 파일(`UserDB.h` 등) 내 `using namespace` 사용을 제거하여 전역 네임스페이스 오염 방지.
  - `System::DBConnectionPool`과 같이 명시적 네임스페이스 지정으로 변경.
  - `#include` 경로를 프로젝트 루트 기준의 상대 경로(`"Core/UserDB.h"` 등)로 일관성 있게 정리.

## 4. 향후 계획
- 보스 AI 패턴 고도화 (페이즈 전환 등).
- 데이터 기반 AI 패턴 로딩 (JSON 연동).
