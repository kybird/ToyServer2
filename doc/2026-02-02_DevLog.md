# DevLog - 2026-02-02

## 1. Monster Collision Refinement
- **Issue:** Steering Force (Spring-based) approach caused monsters to pulse, bounce, and push each other in long chains (push propagation).
- **Solution:** Switched to an **AABB Sliding with Allow Escape** mechanism.
    - **Block Intrusion:** Monsters treat each other as static wall-like obstacles within a single frame. This prevents the "pushing" force from propagating through a crowd.
    - **Allow Escape:** If monsters are already overlapping (e.g., upon spawning), they are allowed to move in directions that reduce the overlap.
- **Result:** Stable, dense monster swarms without visual jitter or unnatural bouncing.

## 2. Dispatcher Async Crash Fix
- **Issue:** Using `WithSession` with local packet references (`const IPacket&`) caused a use-after-free crash because the lambda was executed asynchronously after the packet object was destroyed.
- **Analysis:** A previous refactoring had removed the "synchronous execution on the same thread" optimization from `DispatcherImpl`, forcing every `WithSession` call to be async via `Push()`.
- **Solution:**
    - **Thread Awareness:** Restored `_ownerThreadId` tracking in `DispatcherImpl`.
    - **Synchronous Branch:** Re-implemented `IsInDispatcherThread()` check in `WithSession`.
    - **Result:** If `WithSession` is called from the main logic thread (Dispatcher thread), it executes the callback **immediately (synchronously)**. This makes local references safe again and improves performance by bypassing the task queue.

## 3. Code Cleanup
- **Room_Update.cpp:** Reverted complex `PacketPtr` copying logic in `SendToPlayer` to a simpler reference capture now that the Dispatcher is thread-aware.
- **CMakeLists.txt:** Removed stale references to non-existent files (`Room_Network.cpp`, etc.) to fix linker errors.
- **Room Implementations:** Consolidated missing `Room` member functions (Network, Spatial, Debug) into `Room_Update.cpp` to resolve linker errors caused by the deletion of legacy files.
