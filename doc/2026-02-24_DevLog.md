# 2026-02-24 개발 일지: 무기 공격 로직의 전략(Strategy) 패턴 리팩토링 및 타겟팅/진화 시스템 고도화

## 1. 개요
기존에 거대한 `if-else` 분기문으로 처리되던 `DamageEmitter::Update` 로직을 Strategy(전략) 패턴을 적용하여 다수의 하위 기능 단위 클래스로 분리하고, 무기 진화 기믹을 추가했습니다. 또한, 각 틱마다 런타임에 계산되던 무기 스펙(데미지, 범위, 쿨다운 등)을 필요할 때만 캐싱하여 서버 틱 연산을 최적화했습니다. 

## 2. 주요 작업 및 구현 내용

### 2.1 Strategy 패턴을 적용한 `DamageEmitter` 리팩토링 및 모듈화
- **문제 인식**: `DamageEmitter::Update` 내부에서 무기의 `emitter_type`이나 Trait(특성)에 따라 공격 로직을 `if-else`로 분기 처리하고 있었고, 이를 단일 클래스(`DamageEmitterStrategy`)로 묶었으나 코드가 비대해지고 유지보수가 여전히 어려웠습니다.
- **해결 방안**: `IEmitter` 인터페이스를 정의하고, 각 공격 타입별 구체적인 전략 서브 클래스들을 **각각 독립적인 파일(예: `LinearEmitter.cpp`, `ZoneEmitter.cpp` 등)로 완전 분리**했습니다.
  - `LinearEmitter`: 전방 발사형 투사체 (예: Basic Dagger)
  - `OrbitEmitter`: 플레이어 주위를 공전하는 투사체 (예: King Bible)
  - `ZoneEmitter`: 지정된 반경 내 적들을 락온하여 강타하는 기믹 (예: Lightning Ring)
  - `DirectionalEmitter`: 전방 고정 범위 공격 (예: Whip)
  - `ArcEmitter`: 부채꼴 범위 공격 (예: Greatsword)
  - `AoEEmitter`: 주변 대상 광역 펄스 데미지 (예: Frost Nova)
  - `AuraEmitter`: 플레이어 주변 지속 데미지 및 디버프 (예: Garlic)
  - `FieldStateEmitter`: 지형 기반 지속 데미지 부여
- **구조 변경**: `DamageEmitter` 생성 시 내부 `EmitterFactory`를 통해 파싱된 `emitter_type` 문자열에 맞는 구체 클래스(Emitter) 객체를 동적으로 할당하도록 팩토리 패턴을 조합하여 유지보수성을 극대화했습니다.

### 2.2 런타임 스펙 계산 최적화 및 갱신 (Stat Caching)
- 기존에는 매 게임 틱마다 레벨 상승치, 패시브 아이템 효과 등을 반영한 각종 배율(Multiplier)을 실시간으로 계산했습니다. 
- 이를 개선하고자 무기 스펙 정보를 담는 `WeaponStats` 구조체를 도입하고, 객체 생성 시나 레벨 업 시 최초 1회 연산하여 캐싱해 두도록 변경했습니다.
- 레벨업 시 새로운 에미터를 재생성하지 않고, `Player::RefreshInventoryEffects`가 기존 에미터의 `SetLevel`을 호출하여 `WeaponData.json` 기반의 증가된 스탯 배율을 에미터 객체(`IEmitter`) 내부 로직에 즉시 프로바이딩(`Update()`의 파라미터로 전달)하도록 연동했습니다.

### 2.3 무기 진화 시스템(Evolution System) 구현
- 특정 조건 달성 시 무기가 상위 형태로 변환되는 진화 시스템을 `Player` 및 `PlayerInventory` 계층에 도입했습니다.
- `Player::CheckWeaponEvolutions()` 함수를 구현하여, 특정 무기가 최대 레벨(`maxLevel`)에 도달했고 진화에 필요한 패시브 아이템(`evolutionPassiveId`)을 보유했는지 검사합니다.
- 조건 충족 시, 기존 무기(및 연동된 DamageEmitter)를 인벤토리에서 제거하고, 진화 결과물(`evolutionId`) 무기를 새로 추가하여 Emitter를 재생성하는 방식으로 작동합니다.
- 관련 데이터는 `WeaponData.json`에서 로드하게 되며, `King Bible + Spellbinder = Unholy Vespers` 와 같은 설계가 시스템상 완전히 적용되었습니다.

