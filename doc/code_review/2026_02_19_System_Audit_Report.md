# System í”„ë ˆì„ì›Œí¬ ì¢…í•© ê°ì‚¬ ë³´ê³ ì„œ (Code & Structure Audit)

**ì‘ì„±ì¼**: 2026-02-19
**ëŒ€ìƒ**: `src/System` ì „ì²´ ì½”ë“œ ë° ë””ë ‰í† ë¦¬ êµ¬ì¡°
**ê°ì‚¬ì**: Antigravity Smart Agent

---

## 1. ì¢…í•© ìš”ì•½ (Executive Summary)

`src/System` í”„ë ˆì„ì›Œí¬ëŠ” ê¸°ëŠ¥ì ìœ¼ë¡œëŠ” ê³ ì„±ëŠ¥ MMORPG ì„œë²„ì˜ í›Œë¥­í•œ ê¸°ë°˜ì„ ê°–ì¶”ê³  ìˆìœ¼ë‚˜, **ë¬¼ë¦¬ì  íŒŒì¼ êµ¬ì¡°(Directory Structure)** ì¸¡ë©´ì—ì„œëŠ” ì •ë¦¬ë˜ì§€ ì•Šì€ ë¶€ë¶„ë“¤ì´ ë‹¤ìˆ˜ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.
íŠ¹íˆ ë¶ˆí•„ìš”í•œ ì¤‘ì²© í´ë”(`Dispatcher/DISPATCHER`)ì™€ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ì‚°ì¬í•œ ì¸í„°í˜ì´ìŠ¤ íŒŒì¼ë“¤ì€ í”„ë¡œì íŠ¸ì˜ ì¥ê¸°ì ì¸ ìœ ì§€ë³´ìˆ˜ì„±ì„ ì €í•´í•˜ëŠ” ìš”ì¸ì…ë‹ˆë‹¤.

*   **ì½”ë“œ í’ˆì§ˆ (Logic)**: â­â­â­â­â­ (5.0/5.0) - *ê¸°ëŠ¥ì  ì™„ì„±ë„ ë†’ìŒ*
*   **êµ¬ì¡° ì •ëˆ (Structure)**: â­â­â­ (3.0/5.0) - *ì¤‘ì²© í´ë”, ì¸í„°í˜ì´ìŠ¤ ì‚°ì¬ ë“± ì •ë¦¬ í•„ìš”*
*   **ì„±ëŠ¥ ìµœì í™” (Perf)**: â­â­â­â­ (4.0/5.0) - *ë©”ëª¨ë¦¬ í• ë‹¹ ìµœì í™” í•„ìš”*

---

## 2. ì½”ë“œ í’ˆì§ˆ ìƒì„¸ ë¶„ì„ (Code Quality Audit)

### 2.1. Foundation & Network
*   **Timer & Log**: `TimingWheel`ê³¼ `Async Logger`ëŠ” ìµœì í™” ìˆ˜ì¤€ì´ ë§¤ìš° ë†’ìŒ.
*   **UDP Network**: `Zero-Copy` ë° `Context Pooling`ìœ¼ë¡œ ì¸í”„ë¼ëŠ” í›Œë¥­í•˜ë‚˜, `UDPSession`ì´ í™ í• ë‹¹ì„ í•˜ì—¬ ë³‘ëª©ì´ ë¨. **(Hot Path Violation)**
*   **CrashHandler**: ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆìŒ (`System/Debug/CrashHandler.cpp`).

### 2.2. Data & Utility
*   **Database**: `Async Transaction` íŒ¨í„´ì´ ìš°ìˆ˜í•˜ë©° `RAII` ì»¤ë„¥ì…˜ í’€ë§ë„ ì•ˆì „í•¨.
*   **MQ/Metrics**: ê¸°ë³¸ì ì¸ êµ¬ì¡°ëŠ” ê°–ì·„ìœ¼ë‚˜, `NatsDriver`ì˜ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°€ëŠ¥ì„±ê³¼ `Metrics`ì˜ ë½ ê²½í•© ì´ìŠˆê°€ ì¡´ì¬í•¨.
*   **Console**: ëª…ë ¹ì–´ ì²˜ë¦¬ê°€ ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ ëŒì•„ê°€ë¯€ë¡œ, `Dispatcher`ë¥¼ í†µí•œ ìŠ¤ë ˆë“œ ë™ê¸°í™”ê°€ í•„ìš”í•¨.

---

## 3. ë””ë ‰í† ë¦¬ êµ¬ì¡° ì§„ë‹¨ (Structure Audit)

ì½”ë“œëŠ” í›Œë¥­í•˜ì§€ë§Œ, íŒŒì¼ ë°°ì¹˜ì™€ ì¡°ì§í™” ìƒíƒœëŠ” ê°œì„ ì´ ì‹œê¸‰í•©ë‹ˆë‹¤.

### 3.1. [CRITICAL] ì¤‘ë³µ ì¤‘ì²© í´ë” (Redundant Nesting)
*   **ë°œê²¬**: `src/System/Dispatcher/DISPATCHER` í´ë” ì¡´ì¬.
*   **ì§„ë‹¨**: ëª…ë°±í•œ ì‹¤ìˆ˜ì´ê±°ë‚˜ ì •ë¦¬ë˜ì§€ ì•Šì€ ì”ì¬ì…ë‹ˆë‹¤. `Dispatcher` í´ë” ì•ˆì— ë˜ ëŒ€ë¬¸ì `DISPATCHER` í´ë”ë¥¼ ë§Œë“¤ì–´ íŒŒì¼ì„ ìˆ¨ê²¨ë‘ëŠ” ê²ƒì€ íƒìƒ‰ì„ ë°©í•´í•©ë‹ˆë‹¤.
*   **ê¶Œê³ **: `System/Dispatcher/DISPATCHER/*` -> `System/Dispatcher/*`ë¡œ íŒŒì¼ ì´ë™ í›„ ë¹ˆ í´ë” ì‚­ì œ.

### 3.2. [HIGH] ë£¨íŠ¸ ì¸í„°í˜ì´ìŠ¤ ì˜¤ì—¼ (Root Pollution)
*   **ë°œê²¬**: `src/System` ë£¨íŠ¸ì— `IConfig.h`, `IDatabase.h`, `ILog.h`, `ITimer.h` ë“± 12ê°œì˜ ì¸í„°í˜ì´ìŠ¤ í—¤ë”ê°€ ì‚°ì¬í•¨.
*   **ì§„ë‹¨**: ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ê°€ ë¬¼ë¦¬ì ìœ¼ë¡œ ë©€ë¦¬ ë–¨ì–´ì ¸ ìˆì–´ ì‘ì§‘ë„ê°€ ë‚®ì•„ ë³´ì…ë‹ˆë‹¤.
*   **ê¶Œê³ **: ê° ì¸í„°í˜ì´ìŠ¤ë¥¼ í•´ë‹¹ ê¸°ëŠ¥ í´ë”ë¡œ ì´ë™ (ì˜ˆ: `System/IConfig.h` -> `System/Config/IConfig.h`). `System/Pch.h`ëŠ” ë£¨íŠ¸ ìœ ì§€.

### 3.3. [MEDIUM] ëª¨í˜¸í•œ ì—­í•  ë¶„ë¦¬ (Ambiguous Separation)
*   **ë°œê²¬**: `System/Database`ì™€ `System/Drivers` í´ë”ê°€ ë¶„ë¦¬ë˜ì–´ ìˆìŒ.
*   **ì§„ë‹¨**: `Drivers` ë‚´ë¶€ì˜ `MySQL`, `SQLite`ëŠ” ì‚¬ì‹¤ìƒ ë°ì´í„°ë² ì´ìŠ¤ êµ¬í˜„ì²´ì…ë‹ˆë‹¤. `System/Drivers`ë¼ëŠ” ì´ë¦„ì€ ë„ˆë¬´ í¬ê´„ì ì…ë‹ˆë‹¤.
*   **ê¶Œê³ **: `System/Drivers` í´ë”ë¥¼ ì œê±°í•˜ê³ , `System/Database/Drivers` í•˜ìœ„ë¡œ í†µí•©í•˜ê±°ë‚˜ `System/Database/Impl`ë¡œ ì¬ë°°ì¹˜.

---

## 4. ê°œì„  ë° ë¦¬íŒ©í† ë§ ê¶Œê³  (Action Items)

### ğŸ”¥ Priority 1: í•«íŒ¨ìŠ¤ & ë²„ê·¸ ìˆ˜ì • (Code)
1.  **UDPSession ìµœì í™”**: í™ í• ë‹¹ ì œê±° ë° `MessagePool` í™œìš©.
2.  **MQ Memory Leak Fix**: `NatsDriver` ì½œë°± ë©”ëª¨ë¦¬ ê´€ë¦¬ ì¶”ê°€.
3.  **Console Thread Safety**: `Dispatcher::Push`ë¡œ ëª…ë ¹ì–´ ì‹¤í–‰ ë™ê¸°í™”.

### ğŸ§¹ Priority 2: ë””ë ‰í† ë¦¬ êµ¬ì¡° ì •ë¦¬ (Cleanup)
1.  **Flatten Dispatcher**: `System/Dispatcher/DISPATCHER` í´ë” ì œê±° ë° íŒŒì¼ ìƒìœ„ ì´ë™.
2.  **Move Interfaces**: ë£¨íŠ¸ì˜ `I*.h` íŒŒì¼ë“¤ì„ ê° ê¸°ëŠ¥ë³„ ì„œë¸Œë””ë ‰í† ë¦¬ë¡œ ì´ë™.
3.  **Merge Drivers**: `System/Drivers` -> `System/Database/Drivers`ë¡œ ì´ë™.

### â„¹ï¸ Priority 3: ì•ˆì •ì„± ë° í¸ì˜ì„±
1.  **CrashHandler í†µí•©**: `ServerMain`ì—ì„œ ì´ˆê¸°í™”.
2.  **Metrics Optimization**: ë½ ê²½í•© ìµœì†Œí™”(ìºì‹±).
